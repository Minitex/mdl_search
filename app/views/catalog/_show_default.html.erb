<% borealis_doc = MDL::BorealisDocument.new(document: document) %>

<div class="row">
  <div class="col-md-12">
    <div id="uv" class="uv"></div>
  </div>
</div>

<div class="row">
  <div class="col-md-9">

    <%= render 'rights_statement', config: MDL::RightsConfig.new(url: document['rights_uri_ssi']) %>
    <% content_for(:webpack_bundles) do %>
      <%= javascript_pack_tag 'citation' %>
    <% end %>
    <div id="react-citation-viewer" ></div>
  </div>
  <div class="col-md-3">
    <div id="sidebar">
        <%= render_document_sidebar_partial %>
    </div>
  </div>
</div>

<% content_for(:webpack_bundles) do %>
  <%= javascript_pack_tag 'drawMap' %>
<% end %>
<%= render partial: 'map_view',
  locals: {
    coordinates: @document['coordinates_llsi'],
    map_id: 'full_record_map',
    with_popup: true
  }
%>
<% content_for(:head) do %>
  <link rel="stylesheet" href="/uv/uv.css">
  <%= javascript_pack_tag 'universalviewer' %>
<% end %>

<% content_for(:blocking_javascript) do %>
  <script type="text/javascript">
    window.addEventListener('uvLoaded', function (e) {
      const urlDataProvider = new UV.URLDataProvider();
      const collectionIndex = urlDataProvider.get('c');

      createUV('#uv', {
        iiifResourceUri: '<%= borealis_doc.manifest_url %>',
        root: '../uv/',
        configUri: '../uv/config.json',
        collectionIndex: (collectionIndex !== undefined) ? Number(collectionIndex) : undefined,
        manifestIndex: Number(urlDataProvider.get('m', 0)),
        sequenceIndex: Number(urlDataProvider.get('s', 0)),
        canvasIndex: Number(urlDataProvider.get('cv', 0)),
        rotation: Number(urlDataProvider.get('r', 0)),
        rangeId: urlDataProvider.get('rid', ''),
        xywh: urlDataProvider.get('xywh', '')
      }, urlDataProvider);
    }, false);
  </script>
  <%= javascript_pack_tag 'universalviewer_lib' %>
<% end %>
